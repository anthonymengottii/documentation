---
title: Códigos de erro
description: Referência completa de códigos de erro da API Upay e como resolvê-los
---

A API Upay utiliza códigos de status HTTP convencionais para indicar o sucesso ou falha de uma requisição. Códigos na faixa `2xx` indicam sucesso, códigos na faixa `4xx` indicam erros causados por informações fornecidas (ex: parâmetro obrigatório faltando, autenticação falhou, etc.), e códigos na faixa `5xx` indicam erros nos servidores da Upay.

## Estrutura de erro

Todas as respostas de erro seguem o mesmo formato:

```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Erro de validação nos dados fornecidos",
    "details": [
      {
        "field": "amount",
        "message": "O valor deve ser maior que zero"
      }
    ]
  }
}
```

### Campos da resposta

- **code**: Código único identificando o tipo de erro
- **message**: Mensagem descritiva do erro em português
- **details**: Array com detalhes adicionais (opcional, presente em erros de validação)

## Códigos de status HTTP

### 2xx - Sucesso

<ResponseField name="200 OK" type="success">
  A requisição foi bem-sucedida. O corpo da resposta contém os dados solicitados.
</ResponseField>

<ResponseField name="201 Created" type="success">
  O recurso foi criado com sucesso. O corpo da resposta contém o recurso criado.
</ResponseField>

<ResponseField name="204 No Content" type="success">
  A requisição foi bem-sucedida, mas não há conteúdo para retornar (comum em operações DELETE).
</ResponseField>

### 4xx - Erros do cliente

<ResponseField name="400 Bad Request" type="error">
  A requisição não pôde ser processada devido a sintaxe inválida ou parâmetros incorretos.
  
  **Códigos comuns:**
  - `VALIDATION_ERROR`: Dados de entrada inválidos
  - `INVALID_REQUEST`: Formato da requisição inválido
  - `MISSING_PARAMETER`: Parâmetro obrigatório ausente
</ResponseField>

<ResponseField name="401 Unauthorized" type="error">
  A autenticação falhou ou não foi fornecida. Verifique sua API Key.
  
  **Códigos comuns:**
  - `AUTHENTICATION_FAILED`: API Key inválida ou ausente
  - `INVALID_API_KEY`: API Key não encontrada ou revogada
  - `API_KEY_EXPIRED`: API Key expirada
</ResponseField>

<ResponseField name="403 Forbidden" type="error">
  Você não tem permissão para acessar este recurso.
  
  **Códigos comuns:**
  - `INSUFFICIENT_PERMISSIONS`: Permissões insuficientes
  - `RESOURCE_ACCESS_DENIED`: Acesso negado ao recurso
</ResponseField>

<ResponseField name="404 Not Found" type="error">
  O recurso solicitado não foi encontrado.
  
  **Códigos comuns:**
  - `RESOURCE_NOT_FOUND`: Recurso não existe
  - `PAYMENT_LINK_NOT_FOUND`: Link de pagamento não encontrado
  - `TRANSACTION_NOT_FOUND`: Transação não encontrada
  - `PRODUCT_NOT_FOUND`: Produto não encontrado
</ResponseField>

<ResponseField name="409 Conflict" type="error">
  A requisição conflita com o estado atual do recurso.
  
  **Códigos comuns:**
  - `DUPLICATE_RESOURCE`: Recurso duplicado
  - `SLUG_ALREADY_EXISTS`: Slug já está em uso
  - `CONFLICT`: Conflito de estado
</ResponseField>

<ResponseField name="422 Unprocessable Entity" type="error">
  A requisição está bem formada, mas não pode ser processada devido a erros semânticos.
  
  **Códigos comuns:**
  - `BUSINESS_RULE_VIOLATION`: Violação de regra de negócio
  - `INVALID_STATE_TRANSITION`: Transição de estado inválida
  - `INSUFFICIENT_BALANCE`: Saldo insuficiente
</ResponseField>

<ResponseField name="429 Too Many Requests" type="error">
  Você excedeu o limite de requisições. Aguarde antes de tentar novamente.
  
  **Códigos comuns:**
  - `RATE_LIMIT_EXCEEDED`: Limite de taxa excedido
  
  **Headers de resposta:**
  - `X-RateLimit-Limit`: Limite total de requisições
  - `X-RateLimit-Remaining`: Requisições restantes
  - `X-RateLimit-Reset`: Timestamp quando o limite será resetado
</ResponseField>

### 5xx - Erros do servidor

<ResponseField name="500 Internal Server Error" type="error">
  Ocorreu um erro interno no servidor. Entre em contato com o suporte se o problema persistir.
  
  **Códigos comuns:**
  - `INTERNAL_ERROR`: Erro interno do servidor
  - `UNEXPECTED_ERROR`: Erro inesperado
</ResponseField>

<ResponseField name="502 Bad Gateway" type="error">
  O servidor recebeu uma resposta inválida de um servidor upstream.
  
  **Códigos comuns:**
  - `GATEWAY_ERROR`: Erro no gateway
  - `PAYMENT_PROVIDER_ERROR`: Erro no provedor de pagamento
</ResponseField>

<ResponseField name="503 Service Unavailable" type="error">
  O serviço está temporariamente indisponível. Tente novamente mais tarde.
  
  **Códigos comuns:**
  - `SERVICE_UNAVAILABLE`: Serviço indisponível
  - `MAINTENANCE_MODE`: Sistema em manutenção
</ResponseField>

<ResponseField name="504 Gateway Timeout" type="error">
  O servidor não recebeu resposta a tempo de um servidor upstream.
  
  **Códigos comuns:**
  - `GATEWAY_TIMEOUT`: Timeout no gateway
  - `REQUEST_TIMEOUT`: Timeout na requisição
</ResponseField>

## Códigos de erro específicos

### Erros de validação

| Código | Descrição | Solução |
|--------|-----------|---------|
| `VALIDATION_ERROR` | Dados de entrada inválidos | Verifique os campos no array `details` |
| `INVALID_EMAIL` | Formato de email inválido | Forneça um email válido |
| `INVALID_PHONE` | Formato de telefone inválido | Use o formato: +5511999999999 |
| `INVALID_CPF` | CPF inválido | Forneça um CPF válido (apenas números) |
| `INVALID_CNPJ` | CNPJ inválido | Forneça um CNPJ válido (apenas números) |
| `INVALID_AMOUNT` | Valor inválido | O valor deve ser maior que zero |
| `INVALID_DATE` | Data inválida | Use formato ISO 8601 |
| `INVALID_ENUM_VALUE` | Valor de enum inválido | Use um dos valores permitidos |

### Erros de autenticação

| Código | Descrição | Solução |
|--------|-----------|---------|
| `AUTHENTICATION_FAILED` | Falha na autenticação | Verifique sua API Key |
| `INVALID_API_KEY` | API Key inválida | Gere uma nova API Key no dashboard |
| `API_KEY_EXPIRED` | API Key expirada | Gere uma nova API Key |
| `MISSING_API_KEY` | API Key não fornecida | Inclua o header `Authorization: Bearer YOUR_API_KEY` |

### Erros de recursos

| Código | Descrição | Solução |
|--------|-----------|---------|
| `RESOURCE_NOT_FOUND` | Recurso não encontrado | Verifique o ID do recurso |
| `PAYMENT_LINK_NOT_FOUND` | Link de pagamento não encontrado | Verifique o slug ou ID do link |
| `TRANSACTION_NOT_FOUND` | Transação não encontrada | Verifique o ID da transação |
| `PRODUCT_NOT_FOUND` | Produto não encontrado | Verifique o ID do produto |
| `CUSTOMER_NOT_FOUND` | Cliente não encontrado | Verifique o ID do cliente |
| `COUPON_NOT_FOUND` | Cupom não encontrado | Verifique o código do cupom |

### Erros de negócio

| Código | Descrição | Solução |
|--------|-----------|---------|
| `SLUG_ALREADY_EXISTS` | Slug já está em uso | Use um slug diferente |
| `COUPON_EXPIRED` | Cupom expirado | Use um cupom válido |
| `COUPON_LIMIT_REACHED` | Limite de uso do cupom atingido | Use outro cupom |
| `INSUFFICIENT_STOCK` | Estoque insuficiente | Reduza a quantidade ou aguarde reposição |
| `PAYMENT_LINK_EXPIRED` | Link de pagamento expirado | Crie um novo link |
| `PAYMENT_LINK_INACTIVE` | Link de pagamento inativo | Ative o link ou crie um novo |
| `INVALID_PAYMENT_METHOD` | Método de pagamento inválido | Use: PIX, CREDIT_CARD, DEBIT_CARD ou BOLETO |
| `INSUFFICIENT_BALANCE` | Saldo insuficiente | Aguarde processamento de transações |

### Erros de webhook

| Código | Descrição | Solução |
|--------|-----------|---------|
| `INVALID_WEBHOOK_SIGNATURE` | Assinatura do webhook inválida | Verifique o secret do webhook |
| `WEBHOOK_DELIVERY_FAILED` | Falha ao entregar webhook | Verifique se sua URL está acessível |
| `WEBHOOK_TIMEOUT` | Timeout ao entregar webhook | Sua URL deve responder em até 5 segundos |

## Exemplos de tratamento

### JavaScript/TypeScript

```typescript
import { UpayClient, UpayValidationError, UpayAuthenticationError } from '@upay/upay-js';

const upay = new UpayClient({ apiKey: 'sua_api_key' });

try {
  const link = await upay.paymentLinks.create({
    title: 'Produto',
    amount: 10000,
  });
} catch (error) {
  if (error instanceof UpayValidationError) {
    console.error('Erro de validação:', error.message);
    console.error('Detalhes:', error.details);
  } else if (error instanceof UpayAuthenticationError) {
    console.error('Erro de autenticação:', error.message);
  } else {
    console.error('Erro desconhecido:', error);
  }
}
```

### Python

```python
from upay import UpayClient, UpayValidationError, UpayAuthenticationError

upay = UpayClient(api_key="sua_api_key")

try:
    link = upay.payment_links.create({
        "title": "Produto",
        "amount": 10000
    })
except UpayValidationError as e:
    print(f"Erro de validação: {e.message}")
    print(f"Detalhes: {e.details}")
except UpayAuthenticationError as e:
    print(f"Erro de autenticação: {e.message}")
except Exception as e:
    print(f"Erro desconhecido: {e}")
```

### PHP

```php
use Upay\UpayClient;
use Upay\Utils\Exceptions\UpayValidationError;
use Upay\Utils\Exceptions\UpayAuthenticationError;

$upay = new UpayClient(apiKey: "sua_api_key");

try {
    $link = $upay->paymentLinks->create([
        'title' => 'Produto',
        'amount' => 10000
    ]);
} catch (UpayValidationError $e) {
    echo "Erro de validação: " . $e->getMessage() . "\n";
    print_r($e->details);
} catch (UpayAuthenticationError $e) {
    echo "Erro de autenticação: " . $e->getMessage() . "\n";
} catch (Exception $e) {
    echo "Erro desconhecido: " . $e->getMessage() . "\n";
}
```

### cURL

```bash
# Exemplo de resposta de erro
curl -X POST https://upay-sistema-api.onrender.com/api/v1/payment-links \
  -H "Authorization: Bearer sua_api_key" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Produto",
    "amount": -100
  }'

# Resposta (400 Bad Request):
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Erro de validação nos dados fornecidos",
    "details": [
      {
        "field": "amount",
        "message": "O valor deve ser maior que zero"
      }
    ]
  }
}
```

## Boas práticas

### 1. Sempre trate erros

Nunca assuma que uma requisição será bem-sucedida. Sempre implemente tratamento de erros adequado.

### 2. Use retry com backoff exponencial

Para erros `5xx` e `429`, implemente retry com backoff exponencial:

```typescript
async function retryWithBackoff(fn: () => Promise<any>, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      if (error.status >= 500 || error.status === 429) {
        const delay = Math.pow(2, i) * 1000; // 1s, 2s, 4s
        await new Promise(resolve => setTimeout(resolve, delay));
      } else {
        throw error;
      }
    }
  }
  throw new Error('Max retries exceeded');
}
```

### 3. Monitore rate limits

Verifique os headers de rate limit e ajuste sua taxa de requisições:

```typescript
const response = await fetch('https://upay-sistema-api.onrender.com/api/v1/payment-links', {
  headers: { 'Authorization': `Bearer ${apiKey}` }
});

const remaining = response.headers.get('X-RateLimit-Remaining');
const reset = response.headers.get('X-RateLimit-Reset');

if (remaining < 10) {
  console.warn('Próximo do limite de rate limit');
}
```

### 4. Log erros para análise

Mantenha logs detalhados de erros para facilitar debugging:

```typescript
catch (error) {
  console.error({
    timestamp: new Date().toISOString(),
    errorCode: error.code,
    message: error.message,
    details: error.details,
    requestId: error.requestId, // Se disponível
  });
}
```

### 5. Valide dados antes de enviar

Valide dados no cliente antes de fazer requisições para reduzir erros:

```typescript
function validatePaymentLink(data: any) {
  if (!data.title || data.title.length < 3) {
    throw new Error('Título deve ter pelo menos 3 caracteres');
  }
  if (!data.amount || data.amount <= 0) {
    throw new Error('Valor deve ser maior que zero');
  }
  // ... outras validações
}
```

## Suporte

Se você encontrar um erro não documentado ou precisar de ajuda:

- Consulte a [página de troubleshooting](/troubleshooting)
- Entre em contato: suporte@upaybr.com
- Abra uma issue no [GitHub](https://github.com/anthonymengottii/upay-sdks/issues)
