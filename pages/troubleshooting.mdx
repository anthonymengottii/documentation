---
title: Troubleshooting
description: Soluções para problemas comuns ao integrar com a API Upay
---

Esta página contém soluções para os problemas mais comuns encontrados ao integrar com a API Upay. Se você não encontrar a solução aqui, consulte a [página de erros](/errors) ou entre em contato com o suporte.

## Autenticação

### Erro: "AUTHENTICATION_FAILED" ou "INVALID_API_KEY"

**Problema:** Sua API Key não está sendo aceita.

**Soluções:**

1. **Verifique se a API Key está correta**
   ```bash
   # Certifique-se de copiar a chave completa
   Authorization: Bearer upay_live_abc123...
   ```

2. **Verifique o ambiente**
   - API Keys de teste começam com `upay_test_`
   - API Keys de produção começam com `upay_live_`
   - Use a URL correta para cada ambiente

3. **Verifique se a API Key não foi revogada**
   - Acesse o [Dashboard](https://app.upaybr.com)
   - Vá em **Configurações** > **API Keys**
   - Verifique o status da sua chave

4. **Gere uma nova API Key**
   - Se a chave foi comprometida ou perdida, gere uma nova no dashboard

### Erro: "Missing API Key"

**Problema:** O header de autenticação não está sendo enviado.

**Soluções:**

<CodeGroup>
```bash cURL
# Correto
curl -H "Authorization: Bearer sua_api_key" \
  https://upay-sistema-api.onrender.com/api/v1/payment-links

# Incorreto (sem header)
curl https://upay-sistema-api.onrender.com/api/v1/payment-links
```

```javascript JavaScript
// Correto
const response = await fetch('https://upay-sistema-api.onrender.com/api/v1/payment-links', {
  headers: {
    'Authorization': `Bearer ${apiKey}`,
    'Content-Type': 'application/json'
  }
});

// Incorreto (sem header)
const response = await fetch('https://upay-sistema-api.onrender.com/api/v1/payment-links');
```

```python Python
# Correto
headers = {
    "Authorization": f"Bearer {api_key}",
    "Content-Type": "application/json"
}
response = requests.get(url, headers=headers)

# Incorreto (sem header)
response = requests.get(url)
```
</CodeGroup>

## Validação de dados

### Erro: "VALIDATION_ERROR" com campo "amount"

**Problema:** O valor do pagamento está inválido.

**Soluções:**

1. **Use valores em centavos**
   ```json
   {
     "amount": 10000  // R$ 100,00 (correto)
     // NÃO use: "amount": 100.00
   }
   ```

2. **Valores devem ser positivos**
   ```json
   {
     "amount": 1000   // Correto
     // NÃO use: "amount": -1000 ou "amount": 0
   }
   ```

3. **Use números inteiros**
   ```json
   {
     "amount": 10000  // Correto
     // NÃO use: "amount": "10000" (string)
   }
   ```

### Erro: "VALIDATION_ERROR" com campo "email"

**Problema:** Formato de email inválido.

**Soluções:**

```json
{
  "email": "usuario@exemplo.com"  // Correto
  // NÃO use:
  // "email": "usuario@exemplo"
  // "email": "usuario.exemplo.com"
  // "email": "@exemplo.com"
}
```

### Erro: "VALIDATION_ERROR" com campo "phone"

**Problema:** Formato de telefone inválido.

**Soluções:**

```json
{
  "phone": "+5511999999999"  // Correto (com código do país)
  // NÃO use:
  // "phone": "11999999999"    (sem código do país)
  // "phone": "(11) 99999-9999" (com formatação)
  // "phone": "11 99999-9999"   (com espaços)
}
```

### Erro: "SLUG_ALREADY_EXISTS"

**Problema:** O slug escolhido já está em uso.

**Soluções:**

1. **Use um slug único**
   ```json
   {
     "slug": "produto-premium-v2"  // Adicione sufixo
   }
   ```

2. **Deixe o sistema gerar automaticamente**
   ```json
   {
     "title": "Produto Premium"
     // Não envie o campo "slug"
   }
   ```

3. **Verifique slugs existentes**
   ```bash
   curl -H "Authorization: Bearer sua_api_key" \
     https://upay-sistema-api.onrender.com/api/v1/payment-links
   ```

## Webhooks

### Webhook não está sendo recebido

**Problema:** Sua aplicação não está recebendo notificações de webhook.

**Soluções:**

1. **Verifique se a URL está acessível publicamente**
   ```bash
   # Teste sua URL externamente
   curl -X POST https://sua-url.com/webhook \
     -H "Content-Type: application/json" \
     -d '{"test": true}'
   ```

2. **Use HTTPS (obrigatório em produção)**
   ```
   ✅ https://sua-url.com/webhook
   ❌ http://sua-url.com/webhook
   ```

3. **Verifique se o endpoint está registrado**
   ```bash
   curl -H "Authorization: Bearer sua_api_key" \
     https://upay-sistema-api.onrender.com/api/v1/webhooks/subscriptions
   ```

4. **Use ferramentas de teste durante desenvolvimento**
   - [ngrok](https://ngrok.com) - Túnel para localhost
   - [webhook.site](https://webhook.site) - Teste de webhooks
   - [RequestBin](https://requestbin.com) - Inspeção de requisições

### Erro: "INVALID_WEBHOOK_SIGNATURE"

**Problema:** A assinatura do webhook não está sendo validada corretamente.

**Soluções:**

1. **Use o corpo da requisição exatamente como recebido**
   ```javascript
   // Correto - use raw body
   app.post('/webhook', express.raw({ type: 'application/json' }), (req, res) => {
     const signature = req.headers['x-upay-signature'];
     const isValid = upay.verifyWebhookSignature(req.body, signature, secret);
   });

   // Incorreto - body já foi parseado
   app.post('/webhook', express.json(), (req, res) => {
     const isValid = upay.verifyWebhookSignature(req.body, signature, secret);
   });
   ```

2. **Verifique o secret do webhook**
   ```javascript
   // O secret é fornecido ao criar a subscription
   const subscription = await upay.webhooks.createSubscription({
     url: 'https://sua-url.com/webhook',
     events: ['transaction.paid']
   });
   
   const secret = subscription.secret; // Salve este valor
   ```

3. **Use os SDKs oficiais**
   ```javascript
   // JavaScript
   const isValid = upay.verifyWebhookSignature(rawBody, signature, secret);
   
   // Python
   is_valid = upay.verify_webhook_signature(raw_body, signature, secret)
   
   // PHP
   $isValid = $upay->verifyWebhookSignature($rawBody, $signature, $secret);
   ```

### Webhook está falhando com timeout

**Problema:** Upay reporta timeout ao enviar webhook.

**Soluções:**

1. **Responda rapidamente (< 5 segundos)**
   ```javascript
   app.post('/webhook', async (req, res) => {
     // Responda imediatamente
     res.status(200).json({ received: true });
     
     // Processe de forma assíncrona
     processWebhookAsync(req.body);
   });
   ```

2. **Use filas para processamento pesado**
   ```javascript
   app.post('/webhook', async (req, res) => {
     // Adicione à fila
     await queue.add('process-webhook', req.body);
     
     // Responda imediatamente
     res.status(200).json({ received: true });
   });
   ```

## Transações

### Transação não aparece na listagem

**Problema:** Transação criada não aparece ao listar.

**Soluções:**

1. **Aguarde alguns segundos**
   - Pode haver um pequeno delay no processamento

2. **Verifique os filtros**
   ```javascript
   // Liste todas as transações
   const transactions = await upay.transactions.list({
     page: 1,
     limit: 50
   });
   
   // Verifique se há filtros de status
   const transactions = await upay.transactions.list({
     status: 'PAID' // Remova filtros para ver todas
   });
   ```

3. **Verifique a paginação**
   ```javascript
   // A transação pode estar em outra página
   const transactions = await upay.transactions.list({
     page: 2,
     limit: 10
   });
   ```

### Erro: "PAYMENT_LINK_EXPIRED"

**Problema:** O link de pagamento expirou.

**Soluções:**

1. **Verifique a data de validade**
   ```javascript
   const link = await upay.paymentLinks.get('seu-slug');
   console.log('Expira em:', link.expiresAt);
   ```

2. **Crie um novo link**
   ```javascript
   const newLink = await upay.paymentLinks.create({
     title: 'Produto',
     amount: 10000,
     expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // 7 dias
   });
   ```

3. **Atualize a data de expiração**
   ```javascript
   const updated = await upay.paymentLinks.update('seu-slug', {
     expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)
   });
   ```

### Erro: "INSUFFICIENT_STOCK"

**Problema:** Não há estoque suficiente para completar a compra.

**Soluções:**

1. **Verifique o estoque disponível**
   ```javascript
   const link = await upay.paymentLinks.get('seu-slug');
   console.log('Estoque:', link.stock);
   console.log('Vendidos:', link.soldCount);
   ```

2. **Aumente o estoque**
   ```javascript
   const updated = await upay.paymentLinks.update('seu-slug', {
     stock: 100 // Novo valor de estoque
   });
   ```

3. **Remova limite de estoque**
   ```javascript
   const updated = await upay.paymentLinks.update('seu-slug', {
     stock: null // Estoque ilimitado
   });
   ```

## Cupons

### Erro: "COUPON_EXPIRED"

**Problema:** O cupom está fora do período de validade.

**Soluções:**

1. **Verifique as datas de validade**
   ```javascript
   const coupon = await upay.coupons.validate('CUPOM10');
   console.log('Válido de:', coupon.validFrom);
   console.log('Válido até:', coupon.validUntil);
   ```

2. **Atualize as datas**
   ```javascript
   const updated = await upay.coupons.update('CUPOM10', {
     validFrom: new Date(),
     validUntil: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000) // 30 dias
   });
   ```

### Erro: "COUPON_LIMIT_REACHED"

**Problema:** O cupom atingiu o limite de uso.

**Soluções:**

1. **Verifique os limites**
   ```javascript
   const coupon = await upay.coupons.validate('CUPOM10');
   console.log('Usos:', coupon.usedCount, '/', coupon.maxUses);
   ```

2. **Aumente o limite**
   ```javascript
   const updated = await upay.coupons.update('CUPOM10', {
     maxUses: 1000 // Novo limite
   });
   ```

3. **Remova o limite**
   ```javascript
   const updated = await upay.coupons.update('CUPOM10', {
     maxUses: null // Uso ilimitado
   });
   ```

## Rate Limiting

### Erro: "RATE_LIMIT_EXCEEDED"

**Problema:** Você excedeu o limite de requisições.

**Soluções:**

1. **Implemente retry com backoff**
   ```javascript
   async function retryWithBackoff(fn, maxRetries = 3) {
     for (let i = 0; i < maxRetries; i++) {
       try {
         return await fn();
       } catch (error) {
         if (error.status === 429) {
           const delay = Math.pow(2, i) * 1000;
           await new Promise(resolve => setTimeout(resolve, delay));
         } else {
           throw error;
         }
       }
     }
   }
   ```

2. **Monitore os headers de rate limit**
   ```javascript
   const response = await fetch(url, { headers });
   
   const limit = response.headers.get('X-RateLimit-Limit');
   const remaining = response.headers.get('X-RateLimit-Remaining');
   const reset = response.headers.get('X-RateLimit-Reset');
   
   console.log(`${remaining}/${limit} requisições restantes`);
   console.log(`Reset em: ${new Date(reset * 1000)}`);
   ```

3. **Implemente cache**
   ```javascript
   const cache = new Map();
   
   async function getCachedPaymentLink(slug) {
     if (cache.has(slug)) {
       return cache.get(slug);
     }
     
     const link = await upay.paymentLinks.get(slug);
     cache.set(slug, link);
     
     // Expire cache após 5 minutos
     setTimeout(() => cache.delete(slug), 5 * 60 * 1000);
     
     return link;
   }
   ```

4. **Use batch operations quando possível**
   ```javascript
   // Em vez de múltiplas requisições individuais
   const link1 = await upay.paymentLinks.get('slug1');
   const link2 = await upay.paymentLinks.get('slug2');
   
   // Use listagem com filtros
   const links = await upay.paymentLinks.list({
     slugs: ['slug1', 'slug2']
   });
   ```

## Problemas de rede

### Erro: "GATEWAY_TIMEOUT" ou "REQUEST_TIMEOUT"

**Problema:** A requisição demorou muito para ser processada.

**Soluções:**

1. **Aumente o timeout do cliente**
   ```javascript
   const upay = new UpayClient({
     apiKey: 'sua_api_key',
     timeout: 30000 // 30 segundos
   });
   ```

2. **Implemente retry**
   ```javascript
   async function withRetry(fn, maxRetries = 3) {
     for (let i = 0; i < maxRetries; i++) {
       try {
         return await fn();
       } catch (error) {
         if (error.status >= 500 && i < maxRetries - 1) {
           await new Promise(resolve => setTimeout(resolve, 1000));
           continue;
         }
         throw error;
       }
     }
   }
   ```

### Erro: "SERVICE_UNAVAILABLE"

**Problema:** O serviço está temporariamente indisponível.

**Soluções:**

1. **Verifique o status da API**
   - Acesse [status.upaybr.com](https://status.upaybr.com) (se disponível)
   - Verifique se há manutenção programada

2. **Implemente fallback**
   ```javascript
   try {
     const result = await upay.paymentLinks.create(data);
     return result;
   } catch (error) {
     if (error.status === 503) {
       // Salve para processar depois
       await saveToQueue(data);
       return { queued: true };
     }
     throw error;
   }
   ```

## Ambiente de desenvolvimento

### CORS errors no navegador

**Problema:** Erro de CORS ao fazer requisições do navegador.

**Soluções:**

<Warning>
  **Nunca** faça requisições à API diretamente do navegador. Sua API Key ficará exposta!
</Warning>

1. **Use um backend intermediário**
   ```javascript
   // Frontend
   const response = await fetch('/api/create-payment-link', {
     method: 'POST',
     body: JSON.stringify(data)
   });
   
   // Backend (Node.js)
   app.post('/api/create-payment-link', async (req, res) => {
     const link = await upay.paymentLinks.create(req.body);
     res.json(link);
   });
   ```

2. **Use serverless functions**
   ```javascript
   // Vercel/Netlify Function
   export default async function handler(req, res) {
     const upay = new UpayClient({ apiKey: process.env.UPAY_API_KEY });
     const link = await upay.paymentLinks.create(req.body);
     res.json(link);
   }
   ```

### Variáveis de ambiente não carregam

**Problema:** API Key não está sendo lida das variáveis de ambiente.

**Soluções:**

1. **Verifique o arquivo .env**
   ```bash
   # .env
   UPAY_API_KEY=upay_test_abc123...
   UPAY_WEBHOOK_SECRET=whsec_abc123...
   ```

2. **Carregue as variáveis corretamente**
   ```javascript
   // Node.js
   require('dotenv').config();
   const apiKey = process.env.UPAY_API_KEY;
   
   // Next.js - use NEXT_PUBLIC_ apenas para variáveis públicas
   // NÃO use NEXT_PUBLIC_UPAY_API_KEY (expõe a chave)
   ```

3. **Verifique o ambiente de produção**
   ```bash
   # Vercel
   vercel env add UPAY_API_KEY
   
   # Heroku
   heroku config:set UPAY_API_KEY=upay_live_abc123...
   
   # Railway
   railway variables set UPAY_API_KEY=upay_live_abc123...
   ```

## Ainda precisa de ajuda?

Se você não encontrou a solução para seu problema:

1. **Consulte a documentação completa**
   - [Códigos de erro](/errors)
   - [Referência da API](/api-reference)
   - [Guias](/guides)

2. **Entre em contato com o suporte**
   - Email: suporte@upaybr.com
   - Inclua: código de erro, request ID (se disponível), e exemplo de código

3. **Reporte bugs**
   - [GitHub Issues](https://github.com/anthonymengottii/upay-sdks/issues)
   - Inclua: versão do SDK, ambiente, e passos para reproduzir
