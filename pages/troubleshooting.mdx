---
title: Troubleshooting
description: Soluções para problemas comuns ao integrar com a API UPay
---

## Problemas Comuns e Soluções

Esta página contém soluções para os problemas mais frequentes encontrados durante a integração com a API UPay.

## Autenticação

### Erro 401: "Token inválido ou expirado"

**Problema**: Sua requisição está sendo rejeitada com erro de autenticação.

**Causas comuns**:
- API Key incorreta ou ausente
- Formato do header de autenticação incorreto
- API Key revogada ou expirada

**Soluções**:

1. Verifique se está usando o formato correto do header:
```bash
Authorization: Bearer SUA_API_KEY_AQUI
```

2. Confirme que sua API Key está ativa no Dashboard:
   - Acesse [Dashboard UPay](https://app.upaybr.com)
   - Navegue até **Configurações → API Keys**
   - Verifique o status da sua chave

3. Gere uma nova API Key se necessário

### Erro 403: "Permissões insuficientes"

**Problema**: Você não tem permissão para acessar determinado recurso.

**Solução**: Verifique as permissões da sua API Key no Dashboard e solicite as permissões necessárias.

## Links de Pagamento

### Link de pagamento não está sendo criado

**Problema**: Requisição POST retorna erro 400.

**Verificações**:

1. **Campos obrigatórios**: Certifique-se de incluir todos os campos necessários:
```json
{
  "title": "Nome do produto",
  "amountCents": 9900,
  "settings": {
    "pixEnabled": true
  }
}
```

2. **Valor mínimo**: O valor deve ser no mínimo R$ 1,00 (100 centavos)

3. **Formato correto**: Use `amountCents` (inteiro) ao invés de `amount` (decimal)

### Slug já existe

**Problema**: Erro 409 ao criar link com slug duplicado.

**Solução**: Use um slug único ou deixe o sistema gerar automaticamente:
```json
{
  "title": "Meu Produto",
  "slug": "meu-produto-v2"  // Adicione sufixo único
}
```

### Link não aparece no checkout

**Problema**: URL do checkout retorna 404.

**Verificações**:
1. Confirme que o link está com status `ACTIVE`
2. Verifique se a URL está correta: `https://app.upaybr.com/checkout/{slug}`
3. Aguarde alguns segundos após a criação (propagação de cache)

## Pagamentos

### PIX não está sendo gerado

**Problema**: Checkout não exibe opção PIX.

**Causas comuns**:
- PIX não habilitado nas configurações do link
- Conta não verificada (KYC pendente)

**Soluções**:

1. Verifique as configurações do link:
```json
{
  "settings": {
    "pixEnabled": true
  }
}
```

2. Complete o processo de KYC no Dashboard

### Pagamento com cartão falha

**Problema**: Transação com cartão é recusada.

**Causas comuns**:
- Dados do cartão incorretos
- Cartão sem limite
- Cartão bloqueado pelo banco emissor
- Falha na validação de segurança (CVV, 3DS)

**Soluções**:
1. Solicite ao cliente que verifique os dados do cartão
2. Tente com outro cartão
3. Entre em contato com o banco emissor

### Webhook não está sendo recebido

**Problema**: Seu servidor não recebe notificações de webhook.

**Verificações**:

1. **URL acessível**: Certifique-se de que sua URL é pública e acessível:
```bash
curl -X POST https://sua-url.com/webhook \
  -H "Content-Type: application/json" \
  -d '{"test": true}'
```

2. **Resposta rápida**: Seu endpoint deve responder em até 5 segundos com status 200

3. **HTTPS obrigatório**: URLs de webhook devem usar HTTPS em produção

4. **Verifique logs**: Acesse o Dashboard → Webhooks → Logs para ver tentativas de entrega

## Performance

### Requisições lentas

**Problema**: API está demorando para responder.

**Soluções**:

1. **Use paginação**: Limite a quantidade de resultados:
```bash
GET /api/v1/payment-links?limit=20&offset=0
```

2. **Implemente cache**: Armazene dados que não mudam frequentemente

3. **Requisições paralelas**: Use Promise.all() para múltiplas requisições independentes:
```javascript
const [links, transactions] = await Promise.all([
  fetch('/api/v1/payment-links'),
  fetch('/api/v1/transactions')
]);
```

### Rate limit excedido (429)

**Problema**: Muitas requisições em curto período.

**Limites**:
- Endpoints públicos: 100 req/min por IP
- Endpoints autenticados: 1000 req/min por API Key

**Soluções**:

1. **Implemente retry com backoff**:
```javascript
async function fetchWithRetry(url, options, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    const response = await fetch(url, options);
    
    if (response.status === 429) {
      const retryAfter = response.headers.get('Retry-After') || Math.pow(2, i);
      await new Promise(resolve => setTimeout(resolve, retryAfter * 1000));
      continue;
    }
    
    return response;
  }
}
```

2. **Monitore headers de rate limit**:
```javascript
const remaining = response.headers.get('X-RateLimit-Remaining');
const reset = response.headers.get('X-RateLimit-Reset');
```

## Ambiente de Desenvolvimento

### Testando sem processar pagamentos reais

**Solução**: Use valores de teste específicos:

**Cartões de teste**:
```
Aprovado: 4111 1111 1111 1111
Recusado: 4000 0000 0000 0002
CVV: 123
Validade: qualquer data futura
```

**PIX de teste**: Em ambiente de desenvolvimento, o QR Code gerado não processa pagamento real.

### CORS bloqueando requisições

**Problema**: Erro de CORS ao fazer requisições do navegador.

**Solução**: A API UPay permite CORS de qualquer origem. Se ainda tiver problemas:

1. Verifique se está incluindo os headers corretos:
```javascript
fetch('https://upay-sistema-api.onrender.com/api/v1/payment-links', {
  method: 'GET',
  headers: {
    'Authorization': `Bearer ${apiKey}`,
    'Content-Type': 'application/json'
  }
});
```

2. Para requisições sensíveis, use um proxy no seu backend

## Erros Específicos

### "Invalid JSON"

**Problema**: Corpo da requisição não é um JSON válido.

**Solução**: Verifique a sintaxe do JSON:
```javascript
// ❌ Errado
body: "{title: 'Produto'}"

// ✅ Correto
body: JSON.stringify({ title: 'Produto' })
```

### "CPF/CNPJ inválido"

**Problema**: Documento fornecido não passa na validação.

**Solução**: 
- Use apenas números (sem pontos ou traços)
- Verifique o dígito verificador
- CPF: 11 dígitos
- CNPJ: 14 dígitos

```javascript
// ❌ Errado
cpf: "123.456.789-00"

// ✅ Correto
cpf: "12345678900"
```

### "Amount must be greater than 0"

**Problema**: Valor do pagamento é inválido.

**Solução**: Use valores em centavos (inteiro):
```javascript
// ❌ Errado
amountCents: 99.90

// ✅ Correto
amountCents: 9990  // R$ 99,90
```

## Ainda precisa de ajuda?

Se você não encontrou a solução para seu problema:

<CardGroup cols={2}>
  <Card title="Documentação" icon="book-open" href="/pages/introduction">
    Consulte a documentação completa
  </Card>
  <Card title="Códigos de Erro" icon="triangle-alert" href="/pages/errors">
    Veja todos os códigos de erro
  </Card>
  <Card title="Suporte por Email" icon="envelope" href="mailto:suporte@upay.com.br">
    Entre em contato: suporte@upay.com.br
  </Card>
  <Card title="GitHub Issues" icon="github" href="https://github.com/anthonymengottii/upay-sdks/issues">
    Reporte bugs ou solicite features
  </Card>
</CardGroup>

## Dicas para reportar problemas

Ao entrar em contato com o suporte, inclua:

1. **Descrição clara do problema**
2. **Código de exemplo** que reproduz o erro
3. **Resposta completa da API** (incluindo headers)
4. **Request ID** (se disponível no header `X-Request-ID`)
5. **Timestamp** de quando o erro ocorreu
6. **Ambiente** (produção ou desenvolvimento)

Exemplo de relatório:
```
Problema: Erro 500 ao criar link de pagamento

Request:
POST /api/v1/payment-links
Headers: Authorization: Bearer sk_***
Body: {"title": "Produto", "amountCents": 9900}

Response:
Status: 500
Body: {"error": "Internal Server Error"}
Headers: X-Request-ID: req_abc123

Timestamp: 2024-01-15T10:30:00Z
Ambiente: Produção
```
