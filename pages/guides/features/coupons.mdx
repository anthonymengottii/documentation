---
title: "Cupons de Desconto"
description: "Crie e gerencie cupons de desconto para aplicar em pagamentos"
---

## üéüÔ∏è Vis√£o Geral

O sistema de **Cupons de Desconto** permite que voc√™ crie e gerencie cupons promocionais que podem ser aplicados durante o checkout. Os cupons suportam descontos percentuais ou valores fixos, com configura√ß√µes flex√≠veis de validade e limites de uso.

## ‚ú® Funcionalidades

- ‚úÖ **Tipos de Desconto**: Percentual ou valor fixo
- ‚úÖ **Validade Configur√°vel**: Data de in√≠cio e fim
- ‚úÖ **Limites de Uso**: Total e por usu√°rio
- ‚úÖ **Valor M√≠nimo**: Defina valor m√≠nimo de compra
- ‚úÖ **Valor M√°ximo**: Limite o desconto m√°ximo (para percentuais)
- ‚úÖ **Produtos Espec√≠ficos**: Aplique a todos ou produtos selecionados
- ‚úÖ **Valida√ß√£o P√∫blica**: Endpoint p√∫blico para validar cupons no checkout

## üöÄ Criando um Cupom

### Requisi√ß√£o B√°sica - Desconto Percentual

```bash
curl -X POST "https://api.upay-sistema.onrender.com/api/v1/coupons" \
  -H "Authorization: Bearer SUA_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "code": "DESCONTO10",
    "discountType": "PERCENTAGE",
    "discountValue": 10,
    "description": "10% de desconto em qualquer compra"
  }'
```

### Requisi√ß√£o - Desconto Fixo

```bash
curl -X POST "https://api.upay-sistema.onrender.com/api/v1/coupons" \
  -H "Authorization: Bearer SUA_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "code": "R$50OFF",
    "discountType": "FIXED",
    "discountValue": 5000,
    "description": "R$ 50,00 de desconto"
  }'
```

### Resposta

```json
{
  "success": true,
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "code": "DESCONTO10",
    "discountType": "PERCENTAGE",
    "discountValue": 10,
    "description": "10% de desconto em qualquer compra",
    "minPurchaseAmount": null,
    "maxDiscountAmount": null,
    "maxUses": null,
    "maxUsesPerUser": null,
    "validFrom": null,
    "validUntil": null,
    "productIds": [],
    "status": "ACTIVE",
    "usedCount": 0,
    "createdAt": "2025-12-30T00:00:00.000Z"
  }
}
```

## üìã Campos Dispon√≠veis

### Campos Obrigat√≥rios

- `code` (string): C√≥digo do cupom (√∫nico, m√°x. 50 caracteres)
- `discountType` (enum): "PERCENTAGE" ou "FIXED"
- `discountValue` (number): 
  - Para PERCENTAGE: valor percentual (ex: 10 = 10%)
  - Para FIXED: valor em centavos (ex: 5000 = R$ 50,00)

### Campos Opcionais

- `description` (string): Descri√ß√£o do cupom
- `minPurchaseAmount` (number): Valor m√≠nimo de compra em centavos
- `maxDiscountAmount` (number): Valor m√°ximo de desconto em centavos (apenas para PERCENTAGE)
- `maxUses` (number): Limite total de usos (null = ilimitado)
- `maxUsesPerUser` (number): Limite de usos por usu√°rio (null = ilimitado)
- `validFrom` (string): Data de in√≠cio (ISO 8601)
- `validUntil` (string): Data de fim (ISO 8601)
- `productIds` (array): IDs dos produtos aplic√°veis (vazio = todos)
- `status` (enum): "ACTIVE" ou "INACTIVE" (padr√£o: "ACTIVE")

## üìñ Exemplos Completos

### Cupom Simples - 10% de Desconto

```javascript
const response = await fetch('https://api.upay-sistema.onrender.com/api/v1/coupons', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${apiKey}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    code: 'PROMO10',
    discountType: 'PERCENTAGE',
    discountValue: 10,
    description: '10% de desconto em qualquer compra'
  })
});
```

### Cupom com Validade e Limites

```javascript
const validFrom = new Date();
const validUntil = new Date();
validUntil.setDate(validUntil.getDate() + 30); // V√°lido por 30 dias

const response = await fetch('https://api.upay-sistema.onrender.com/api/v1/coupons', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${apiKey}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    code: 'BLACKFRIDAY',
    discountType: 'PERCENTAGE',
    discountValue: 25,
    description: 'Black Friday - 25% de desconto',
    minPurchaseAmount: 10000, // M√≠nimo R$ 100,00
    maxDiscountAmount: 50000, // M√°ximo R$ 500,00 de desconto
    maxUses: 1000, // M√°ximo 1000 usos totais
    maxUsesPerUser: 1, // 1 uso por usu√°rio
    validFrom: validFrom.toISOString(),
    validUntil: validUntil.toISOString()
  })
});
```

### Cupom para Produtos Espec√≠ficos

```javascript
const response = await fetch('https://api.upay-sistema.onrender.com/api/v1/coupons', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${apiKey}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    code: 'PRODUTOESPECIAL',
    discountType: 'FIXED',
    discountValue: 2000, // R$ 20,00 de desconto
    description: 'R$ 20,00 de desconto em produtos selecionados',
    productIds: [
      'produto-1-id',
      'produto-2-id'
    ]
  })
});
```

## ‚úÖ Validando um Cupom

### Endpoint P√∫blico (Checkout)

O endpoint de valida√ß√£o √© **p√∫blico** e n√£o requer autentica√ß√£o. Use-o no checkout para validar cupons:

```bash
curl -X POST "https://api.upay-sistema.onrender.com/api/v1/coupons/validate" \
  -H "Content-Type: application/json" \
  -d '{
    "code": "DESCONTO10",
    "amount": 10000
  }'
```

### Resposta - Cupom V√°lido

```json
{
  "success": true,
  "valid": true,
  "data": {
    "code": "DESCONTO10",
    "discountType": "PERCENTAGE",
    "discountValue": 10,
    "discountAmount": 1000,
    "finalAmount": 9000,
    "description": "10% de desconto em qualquer compra"
  }
}
```

### Resposta - Cupom Inv√°lido

```json
{
  "success": false,
  "valid": false,
  "message": "Cupom n√£o encontrado ou inv√°lido"
}
```

### Exemplo em JavaScript (Checkout)

```javascript
async function validateCoupon(code, amount) {
  const response = await fetch('https://api.upay-sistema.onrender.com/api/v1/coupons/validate', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      code: code,
      amount: amount // Valor em centavos
    })
  });
  
  const data = await response.json();
  
  if (data.valid) {
    console.log(`Desconto: R$ ${(data.data.discountAmount / 100).toFixed(2)}`);
    console.log(`Valor final: R$ ${(data.data.finalAmount / 100).toFixed(2)}`);
    return data.data;
  } else {
    console.error(data.message);
    return null;
  }
}
```

## üîç Listando Cupons

### Listar Todos os Cupons

```bash
curl -X GET "https://api.upay-sistema.onrender.com/api/v1/coupons?page=1&limit=20" \
  -H "Authorization: Bearer SUA_API_KEY"
```

### Buscar Cupom Espec√≠fico

```bash
curl -X GET "https://api.upay-sistema.onrender.com/api/v1/coupons/{id}" \
  -H "Authorization: Bearer SUA_API_KEY"
```

## ‚úèÔ∏è Atualizando um Cupom

```bash
curl -X PATCH "https://api.upay-sistema.onrender.com/api/v1/coupons/{id}" \
  -H "Authorization: Bearer SUA_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "INACTIVE",
    "maxUses": 500
  }'
```

<Note>
  Voc√™ pode atualizar apenas os campos que desejar. Campos n√£o enviados permanecer√£o inalterados.
</Note>

## üóëÔ∏è Deletando um Cupom

```bash
curl -X DELETE "https://api.upay-sistema.onrender.com/api/v1/coupons/{id}" \
  -H "Authorization: Bearer SUA_API_KEY"
```

<Warning>
  A exclus√£o √© permanente. Cupons j√° utilizados mant√™m o hist√≥rico de uso.
</Warning>

## üìä Regras de Valida√ß√£o

O sistema valida automaticamente:

1. ‚úÖ **C√≥digo v√°lido**: O cupom existe e est√° ativo
2. ‚úÖ **Validade**: Data atual est√° entre `validFrom` e `validUntil`
3. ‚úÖ **Limites de uso**: N√£o excedeu `maxUses` e `maxUsesPerUser`
4. ‚úÖ **Valor m√≠nimo**: Compra atinge `minPurchaseAmount`
5. ‚úÖ **Produtos aplic√°veis**: Produto est√° na lista `productIds` (se especificado)
6. ‚úÖ **Desconto m√°ximo**: Para percentuais, respeita `maxDiscountAmount`

## üéØ Casos de Uso

### Promo√ß√µes Tempor√°rias
Crie cupons com validade limitada para campanhas espec√≠ficas.

### Descontos por Volume
Configure valor m√≠nimo de compra para incentivar compras maiores.

### Cupons Exclusivos
Use limites de uso para criar cupons exclusivos ou limitados.

### Produtos Espec√≠ficos
Aplique descontos apenas a produtos selecionados do cat√°logo.

### Primeira Compra
Configure `maxUsesPerUser: 1` para cupons de primeira compra.

## üìö Pr√≥ximos Passos

<CardGroup cols={2}>
  <Card title="Refer√™ncia da API" icon="code" href="/pages/coupon/reference">
    Veja todos os endpoints dispon√≠veis
  </Card>
  <Card title="Payment Links" icon="link" href="/pages/guides/features/payment-links">
    Integre cupons no checkout
  </Card>
</CardGroup>

